00:51是好是是嗯嘘嘘嘘嘘切嘘嘘嗯，是不如他。亲好，请我们开始 OK。好上节课。我们最后讨论了一下这个 RDV 的这个连接的可扩展性。
05:46就是说当你的这个网卡和房子这个连接变多的时候，性能会变差啊，但是我们其实是需要讨论一下的，因为这个事情它它并没有一个绝对定论。因为你本身你的这个连接的这个可扩展性，对吧？
05:58它其实是这个这对定个它其实是依赖于这个硬件的这个实现的。那么那么我一个很很很很很很需要回答的问题，就是说当你的这个硬件的趋势开始变得更加复杂的时候，或者说硬件变得更强的候会怎么样啊？其实我们这边有观察到一些，就是说这个事情本身并不是这个这个这个这个这个这个这个一个一个绝对的定润。
06:19比如说我们测试了像这个一二年的卡，包括一八年的卡和二二二零年的卡，我们就会发一些像未来的这些卡。它的这个这个虽然啊它的这个存的这个 s 啊其实并没有变得很大啊。因为原因是因为 s rom 它的这个晶体管消耗是比其他的这个组件会更大的。但是整整体的这个网卡的这个 schebility 还是变好的。
06:41比如说这个一三年的卡了，一四年的卡，它其实只能支持几十个 QP，它的这个呃可扩展就烂掉。但是一七年的这个网卡，它其实能支持到八十个 QP 八十个八十啊，
06:53不较不是啊，应该八十个全链接，就是八乘乘以二，大概一百百六十个这样的一个规模。它的性能其实还是能能可可扩展。虽然它们两个的这个大小其实差不多的这里面的原因，
07:03也是因为这个网卡厂商它对于处理这个 catch mix 的这个这个逻辑其实也是会有优化的。当然 RDMA 最近其实还会有一些比较新的这个 transport，比如说叫叫 DDDDC 啊、 DDCT 啊、 DCT 这个东西呢那个叫什么？它的概念性就是我一个连接啊，
07:20可以去同时跟多个点多台机器通信。那它背后的实现方式实际上是它比如说原本我一个连接四来跟 a 通信，如果我要跟 b 通信的时候呢，它会先发一个这个这个断开连接的请求给 a 然后呢与此同时它会并行的去发一个重连的这个请求给 b 然后这个重连这个请求呢会带上这样一个配的啊这样的一个 lotype 呢它它其实就可以实现就是大极大的它会稍微牺牲一点，牺牲一点网络的这个延迟啊，但是它会极大程度的提升这样的一个一个吞突啊，
07:50所以说它啊其实是是有一个一定程度能解决问题，但是因为它会有更多的 wrn trip，所以它的这个影响其实能还比较难估计，所以并没有一个非常大规模的这样的一个采用 OK。好，那么最后的话我们来呃简单给一个案例，
08:07就是说怎么怎么怎么用 RDM 优化系统。我们会看一下，就是说具体来看一下，在这个特别的 case 里面，对吧？我我我如果用 CPU 这个啊用这个优化会出现什么样样的这样的一个情况，
08:18然后怎么去去优化。然后今天我们的这个例子可能主要关注的在在这个 CPU 上啊，等我们介绍完这个计算之后，我们可能会再讲一些这个这个这个介绍一些这个这个 GPU 的这样的例子。 OK。好，
08:31就说我们的一个场景啊，其实非常明确的就是在一个数据中心中，对吧？我们需要去缓存这样的一个数据。那么怎么缓存这个数据呢？这个系统一般来说它会啊部署一个就是 TYS store 啊，
08:41就是说类似于 memory cash d 这样的使用它支持的操作就是这样一个 gap， put 这样一个行为 OK。那么那么在在我们 build 这个系统之前呢，我们就会画一下这个系统的 model，对吧？其实就是说我有很多的这样一个 tyde。
08:55好，我就是说这个这个这个就有一台这个 memory cash d 的这个 server 做这样的一个访问。好，那么这个大家可以思考一个一个问题，一个问题就是我们假设啊原本有个 memory cash d 的这样的一个实现了啊，这个实现非常经典。
09:09然后我把里面的这个网络通讯操作全部换成 RDB 的操作，这个东西就能不能让这个 memory cash d 的这个这个实现变得非常非常高效啊，这个事情可不可以可不可能实现啊？其实我们告诉他这个东西是不能啊，目前来看是不能实现的。我们需要一个 completely 的这样一个从呃这个这个这个 redeside 为什么说这个事情是不能实现的那我们首先先看一下，
09:35对吧？这个这套实现到底会有什么问题？这个其实我也是我就我觉得系统里面尤其做性能优化，对吧？最重要一点就是我们要把一个系统啊做一个拆解啊，然后去分析一下里面的这个性能。
09:46 bottle neck 在哪里。那比如说大家想一想，我们这套系统里面它的 bottle neck 在哪里面在哪里面？其实这套系统我们可以很清晰。实际上看到就是现在这种种 count server 架构，它的 bottle neck，
10:00实际上 server server。因为为什么你有很多的这个 cent 啊去连接这样的一个跟 server 通信。那么 cint 的这个这个计算资源肯定是比你 severver 多的。因为我 n 个 kind 就就一个 server，一般来说我不会部署很多次。为什么？
10:13因为当你的时候部署太多，你不就浪费额外的这样的一个资源嘛。 OK。好，那么这一套系统的话，它的 ball neck 其实可能会存在在很多方面，
10:23对吧？比如说我把这种划开的话，你看的想要跟 server 通信，你得先接一个网络交换机，网络交换机会接一个网卡。网络会根据我们一起讲的这个 PCIE，
10:32然后 PCIE 会通过这个内存总线跟这个 CPU 这个交互。那它的这个 bt neack 如果是在 server 的话，那就会有另一个问题，就是我到底是算力的这个 bouse neack ack，对吧？还是这个仿力的这个 boudneack 呢。
10:45对，说所谓算力 bound deg，就是说我这个 CPU 每秒只能发两百个请求，然后我的网卡每秒能除以四百个请求，那这个 bound dg g 就是 CPU。那如果我的这个网卡每秒能除以四百呃四百九 CPU 能除以八百元。
10:56那 bound deg 就是什么就在网卡。那这个东西我们能不能分析呢？我们其实是可以完全可以分析出来，就对于一个特定的原因，大家注意意应特特原因，我们完全可以算。
11:06比如说你这个对于一个 very cash d 这样一个 server，我们问问大家一个问题，大家有没有想过它每秒最多能处理多少个请求？假设我们用 RDMA，因有我们前面讲的这套这个 RDA 这套框架啊，其实我们可以算出来的。
11:19大家想想我们一个这个 marry cash d 这个 server，我们先看算例对吧，算例它如果要做这个说做一个 QSS 请求啊，他其实本质上就干三件事，第一件事就是他先收到这样的一个请求，对吧？
11:34然后收到这个请求呢，他就是做内存查一个 QQ store 的这个表一般是还是表好，查完这个表之后呢，我把这个结果发布给用户，对吧？本质上不就是这样的一个操作，
11:44然后 atch table 相信大家都都应该都应该上过，对吧？那它的核心操作，虽然你的整体的这个这个这个这个这个这个还呃复杂的始 hatable 实际上非常复杂的。但是我们站在一个系统的角度分析性能角度来说，一个 hash table 其实本质上可以被抽象成什么两次内存查找，
12:02对吧？或者三次内存查找，然后做一些简单的哈希计算。那这些简单的哈希计算时间其实是可以忽略不计的。因为你你你本身你的这个希 hatable 就做了一些非常简单的寄存器的这样的一个操作。好，
12:14那么把这个东西之后呢，我们就可以对整个操作进行进一步的裁解的。比如说我们第一个受网络请求，这个要花多少时间，然后我们前面上过两节课了，对吧？
12:24教大家不较较啊，但是这个个大家应该有印象，就是我们读一块随机内存，它的这个延是大在一一百大。然后我我算一次 hach function 一大秒，然后我去查找这个 hch table，
12:34我们说两到三次内存请求啊，它大概是什么？大概是两百到四百纳秒，因为你是一个随机内存，访问大概在一百纳秒左右。然后你再发一次内存啊，
12:44再显示内存，大概是一百纳秒。然后你要发一次 reply，你就是要把这个结果返馈给用户。我们说你还要花，这大概是四百到八百纳秒。
12:52就因为你为什么会会有那么长时间？因为它是个你发一个 RDB，请求是个 MMIO，就 memory mac IO 对吧？我们说这个东西它其实是有开销的。好，
13:00那么到了这个之后，我们其实就可以大概算一下，就是我们的整个这个这个这个收到一个 hash table 的这样的一个请求。到这个访问这样的一个整个过程啊，它大概就要到六百到一千四百纳的，就是做做一个请求。
13:14那么大家想想，有了这个时候，我们其实就能够算出来就是我一个 CPU 的这样的一个核心，对吧？它每秒大概就能处理什么，就就能够处理这个它能够够理这这个这个这这个多少请求啊，
13:27我们说一秒是有多少纳秒，有九个零九个零。然后你去除以一个请求，我们假设它平均是一千纳秒啊，因为我们前面算出来这个是六百到四百一千四嘛，那我们就把它求平均一千纳秒。
13:38好，一算啊，我们就发现你一个这个 CPU 单核啊，每秒能做什么呢？能做一一个边脸的这样的请个这这这这个这个 memory cash d 的这样的请求。好，
13:49那么再回过头来我们的问题，我们说你的这个系统对吧，我们当我们用 memory cash d 这样一套系统，然后我把它的这个网络替换成 RDV 之后，它的瓶颈在哪呢？大家大家想想这个平台那就取取决于你的这个网卡它它这性性能有多少是吧？
14:04那我们说现在的网的性能有多少，大家可以去跑个压测对吧吧。现在的网能能轻松的轻轻松松的甩到一百到两百个。这这样一个 milp PS 那意味着什么？意味着说我台 server ver 的 CPU 全部给你现在的主流的 server，你先不考虑 GPU，
14:18但是那些 server 的核比较多，你正常的一一台互联网公司 server， server 大概是四十个核或者二十个核。好，我全跑了，也就是二十到三十个 millic 这样一个请求。
14:27那我远远没有达到这样的一个网卡的这样的极限。那我们就可以下定一个什么结论啊，就是这个这个这个如果你简单的把 mamber cash d 的这样的一个实现，替换成这样的一个这个 RDB 的实现啊，它其实并不能用吧这个那但但在这里有两点需要注意啊，就是说这个第一我们这个结论是在我们这样一套这个 system model 下分析出来的。
14:52如果你的这个 systemodel 变了，对吧？比如说我这个 CPU 和不是 CPU，我是 GPU 把握的核特别特别多，虽然特别多，但是结论其实可能是会啊发生变化的啊，
15:01可能发生变化，这要注意。所以但是这样一套分析的方法啊，对于所有的这个系统啊都都是普世的。好吧，都其实都都都应该是这样一个普世的状况啊啊。
15:15所以我们大家就要注意，就是说这个这个首先这个方这个结论是是是个 depends 的，但这个方法是通误的。好，那这个时候我们怎么办呢？其实我们会发现我们前面这节课讲过一点，
15:25对吧？就是我们的你的 CPU server CPU 啊，它是是是是这个没事干的啊，就是啊就是跑满了这网卡还有空闲，那怎么办？我们说你网卡它的空闲可以用来做什么？
15:35做文三 d 的这样的一个 RDA 的操作。而且我们三 d 的 RDA 操作，它的这个频率费啊，它的这个这个这个这个带宽，其实它的 QPS 其实会比你说消息还要多一点，因为它的处理逻辑会更简单一点。
15:47那我们能不能在比如说你的这个 CPU 成为 bottle neck 的的时候，对我用用文三的 RDMA 再去做一些这样的一个操作，对吧？以期望啊这样的一个这个这个这个东西能那这个性能更高。那么我们怎么用文塞类的 RDA 去做这样的一个 QYS ore 呢？那大家想想我们这个文塞类的 RDA，
16:07它本质上什么？它本身就是个内存读，对吧？那我一个 hash table 需要什么？它本质上不也是一个内存读吗？大家看我作为一个 hash table，
16:16它干的些什么？无非就是我先假设我是一个链表的， hash 是宝最简单的那我无非就是我先 hash 上一个 bucket 对吧？然后然后这个 bucket 的限，然后呢，我就在这个券里面找到第一个跟你的这个 input 的 match 的这样一个值。
16:29那么原本这个过程是 CPU 的这样的 right。那我现在把所有的这个操作全都替换成 RDV 的这样的一个操作，那不就能实现这样的一个这个这个这个这个这个这个这个绕绕，绕过这 CPU 的这样 PSS 了嘛。这个其实就是很早期啊，那就是有这样的一个想法。
16:46但是这个想法有一个最关键的问题，就是大家觉得这个问这这套实现性能高不高呢？那所谓性能高不高，我们就得看你一个操作，它的延迟达不到要求，你的吞吐达不到要求，
16:56对吧？其实我们这套方法一看就能感觉到一点，就是它的这个延迟啊，至少肯定是比不过你 CPU 的。为什么？因为我们说 CPU 你只要发一个网络请求到 server，
17:05 server 做完就返回来。但是如果你是这套 RD 杯的这样的一个实现，对吧？我比如说我就就一一个基基的的 hah table。如果我有一个 hash crash 就是二的话，那我按照我们现在这个设计，
17:17我们先得花一个 RDV 去读 bucket，读完 bucket 之后我去读这个的第一个那读完之后我再去读第二个啊，这样一直读读读读下去。大家想它的这个复杂都是随着什么你的这个 chachange 的数量去去去变大。那这个东西它在一个本质认为它就是会有个 network applfication，就是原本我要做一个网络操作，
17:34我一个网络写就就能稿定。但是现在因为我 RDV 的这个文塞这的这个语义比较有限，对吧？我得花好多个网式才能改变 OK。好，那这个问题怎么解决，
17:43怎么怎么怎么解决呢？解决了啊，这个就就催生了啊一系列的这样的一个研究，叫做这个 audimy friendly 的这样的一个 data structure。 OK 好，那那那那，
17:54因为后面东西还比较多啊，因为时间关系，我们可能今天要不就就先上这啊，剩下一节我们下下一节再讲好不好？行，我们只有先到是一个。
18:30对，没事，开始撤，不是只要打开是拜拜，对不对？不是我觉得这一验周理士好，
19:58你记得啥？然后我都会想到呃，图片限制有那个什么时候，然后主持一是高层有三十步等过一会会他不是同意结束下，有一个 ITV 的做这个。呃哎，
20:32对对对对，对我说是你说的口碑的结是是什？我就是说就这这这个截图啊啊，你你首先你讲的这个是没有错嗯，对吧？但是它从性能上来说并不是对优，
20:46所以你放锁其实是越早放肯定越好。对对，那么在对于 QVC 来说的话，只要你这个高层的可能就是他把那个库制信息暴露下来了，那么这个时候其实就可以放锁。就是这里为什么从这里放锁？
21:00对，那因为它其实你想 QQ facebook 保证游戏的原因是什么？就是只要你放锁了之后，你就不去拿新的锁，它就能保证你，对吧？
21:09这个你你这边因为只有放锁，你不要拿新的锁，所以肯定是正确。而且你这个喘三 tion，它不会因为这个 abort 会被抹掉，对吧？
21:17它这个修改其实都是都是很提高的。因为因为因为这个高层可能感它决定提高，不用提交了，就意味着就是即使他已经没有通过，可以送我小时。对，
21:27因为他们因为因为你想你图片啊，你要拍图片的前提是什么？就我我得先把我的修改都落出来。所以说就是说即使他这里和 mate 就是还没交上去，但可能其他就是我们这里放了锁呢，就会有其他的拿锁呢，
21:41要去可能区还要查这里的数据，你会即使没有同步到这边，他也是哦不是放锁的前提肯定是你得先把数据修改好，才才才才能放锁。就是你你如果没改好的，没办法，
21:54学术修数据修改之后配的结构。对对对，那个 preprepaare 结段就是会把数据修修改好，然后然后把这个锁拿着。对，当然你也可以不去修改这个数，
22:05这个数据在旁面这张显示这个这个没有太不大区，因为拿着锁其他人也不知道，对吧？哪里走？别人读不到。所以你在普开阶段写跟在我个阶段写，
22:14其实没没没有区别。就是我因为我我嗯就是你的问题，实际上是比如说我写我写我我写了一个 a 对吧？然后我后面有个 n lock 这个 a 对吧？然后你说这个东西，它到底要是在 prepare 阶段搞，
22:33还在口碑的阶段搞。然后你想想看，我我在写 a 之前它一定会有个 lock，对吧？那么你想他在这个这个这段写跟在这这段写，其实没有任何区别，
22:46对吧？你我有什么区别？就是说他这个东西能不能被别人读到，或者这个 a 能不能被别人访问？嗯嗯，这个 a 其实不能被任何人访问的，
22:54所以说他在哪里写都无所谓。那就是这样涉及到一个问题，就是如果他在同业阶段就说去写的话，那那么他他还能够在决定同那的时候去放。那这这这这这边我可能知道就是放锁一定有个隐藏程序。比如说我要放 a 的锁，
23:12那一定得等 a 写完了，放锁，就这这一定是有个严格的典判的，写就放锁，一定得等到 b 写完哦。对你想要保证这个是不是就就对了，
23:21是对嘘嘘一什么问题是是是是是嗯当时呢要不解，我也知道是大概的东西都在下面先上来。嗯嗯，是嗯是谢的对，不？西东西马上提出了身么经验，
43:02用微信最新的东西，你不去洗衣机，我没说这些比较小，我们有客户喜欢的。没事，你上次就说联系合同就他妈的六十六个哦，
43:27那你说确确实超粉，那一看绿色，因为关心这四点就是就解对，那为什么是吗？好，但是为什么不去？
44:18因为这是明字开始始。这个是一个谁？是你没有，可能一天你手月一个多粉丝我就适合，我就想喝，也可以把这一个没听见那个苹果醒一醒。
45:32行，不在模型，也不是你要听。对，正常坚果图选择样品牌小叔叔今天有个楼下去休息的，帮忙都八点坐回他去短信等下啊，
46:10有没有问题？答疑半句，这东西还是啊我这得这口是 a 的链接啊，这个干哪一个？你看一个什么东西，明明如何一个我这边这个这个不是我才电脑。
47:09对，就是比方一个考试员先就就这这样吧，这这进进入步步阶吧。对不起，我从的我觉得哦，然后我我帮你一下数清楚，
47:31这是五个。一个多时时，我们要一共多少钱？我说你四十五呃，应该都拿了，所以你们就就差不多拿一版，
47:40应该应该过了。对，不够在在在那里西有入住。我怎么感觉我就好像三十理见，忘了这个谁嗯回归一次，我一定是有书卷的，
48:06有什么要求？没有？对，您您这一般一般的要求是不是对，就就是什么床位上面啊，应该没有大大大概该七月这个好一点了。
48:17联系啊，实在是电动扫雷动货车超人就是一个原来截图嗯，我归一下，还有不要说是解封微信了啊，微信已经付款，感谢不行，
48:40我我现在找一个。对，然后那应该就我们上面签完，我我拿下来，因为他拆他也没法分也行也行。对，
48:50那我们什么时候一提提十分钟开始发卷呢？截十分钟钟，然后考多长时间？考了几条，差不就是五点点四十 OK 遇到，但是我对不起，
49:09不知道。那么是的，说怎么会什么？只能是来说好选嗯，选选。对对对对，
49:19选选好。你好，但是我三块钟，三十九应该行，我们有这个东西的，行，
49:44大概是多少？然后是个挺好的，我也没我没吃一口，一块九九，我给计给他友个电话，你为什么那么有世界？
50:19然后我就你也是，你说操作，为什么这就不嗯要了解的是那个嗯七我去不是厉害，我那个衬衫是优惠，最后一个三个，你什么没有，
50:57他上面写的车应该没有。请问一你是不是走进去这些，然后就是啊他这有个三二了，也许什么二十一回归直线回关就是就可以，我就不是。然后我一二三四嗯嗯，
51:46对，这是图你写的那啊牛 k 关键是没问题，还行，是对不起的。第几个为什么可以说啥？一个 g 坐在这青春系，
52:36这这 p 系统文件系统统计，我现在菜就行了，你说十分钟我多长吗？一百零七，这改过来不会刚刚上红外线这个监控。好清楚自己的修哦，
53:23遗串为什么？就就这里面考虑有一面发给我一下快递信息，我不舍，我们要的，可是钱你是不是你负责安究？对，
53:46这个想法会带上这种球，你找不是，是我感觉刚错嗯，这个嗯拜拜。那我们然后他你是不开始迷你世界，为什么这个事候现在是不是嗯，
54:33我这个是每一个竞争，对，能够按照这个这个东西嗯。